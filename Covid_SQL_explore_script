#view covid deaths

SELECT *
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
WHERE continent is not null
order by 3, 4

#view covid vaccinations

SELECT *
FROM `portfolioprojects-447322.Covid_data.CovidVaccinations` 
order by 3, 4

#selecting data to use

SELECT Location, date, total_cases, new_cases, total_deaths, population
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
WHERE continent is not null
order by 1, 2

#looking at Total Cases vs Total Deaths
#shows likelihood of dying if you get covid in the US

SELECT Location, date, total_cases, total_deaths,(total_deaths/NULLIF(total_cases, 0))* 100 AS DeathPercentage
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
WHERE Location LIKE 'United States'
and continent is not null
order by 1, 2

#looking at Total Cases vs Population, US specific
#shows what percentage of the population got covid

SELECT Location, date, population, total_cases, (total_cases/population) * 100 AS CasesPerPopPercentage
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
WHERE Location LIKE 'United States'
and continent is not null
order by 1, 2

#looking at countries with highest infection count compared to population

SELECT Location, population, MAX(total_cases) as HighestInfectionCount, MAX((total_cases/population)) * 100 AS CasesPerPopPercentage
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
#WHERE Location LIKE 'United States'
WHERE continent is not null
Group by Location, population
order by CasesPerPopPercentage desc

#showing countries with Highest Death Count per Population 

SELECT Location, MAX(CAST (total_deaths as int)) as TotalDeathCount
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
#WHERE Location LIKE 'United States'
WHERE continent is not null
Group by location
order by TotalDeathCount desc

#breaking things down by continent
#showing the continents with highest death count

SELECT continent, MAX(CAST (total_deaths as int)) as TotalDeathCount
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
#WHERE Location LIKE 'United States'
WHERE continent is not null
Group by continent
order by TotalDeathCount desc

#corrected break down by continent 
#showing the continents with highest death count with counts added up for entire continent rather than just the country with the most deaths being counted

SELECT Location, MAX(CAST (total_deaths as int)) as TotalDeathCount
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
#WHERE Location LIKE 'United States'
WHERE continent is null
Group by location
order by TotalDeathCount desc

#global numbers

SELECT date, SUM(new_cases) as TotalCases, SUM(CAST(new_deaths as int)) as TotalDeaths, SUM(CAST(new_deaths as int))/NULLIF(SUM(new_cases), 0) * 100 AS GlobalDeathPercentage
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
#WHERE Location LIKE 'United States'
WHERE continent is not null
Group by date
order by 1, 2

#shows entire Global Death Percentage, Total Cases, and Total Deaths

SELECT SUM(new_cases) as TotalCases, SUM(CAST(new_deaths as int)) as TotalDeaths, SUM(CAST(new_deaths as int))/NULLIF(SUM(new_cases), 0) * 100 AS GlobalDeathPercentage
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
#WHERE Location LIKE 'United States'
WHERE continent is not null
#Group by date
order by 1, 2

#reviewing the vaccinations table

SELECT *
FROM `portfolioprojects-447322.Covid_data.CovidVaccinations` 
order by 3, 4

#joining the Deaths and Vaccinations tables together

SELECT *
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` dea
JOIN `portfolioprojects-447322.Covid_data.CovidVaccinations` vac
  ON dea.location = vac.location 
  and dea.date = vac.date

#looking at Total Population vs Vaccinations

SELECT dea.continent, dea.location, dea.date, dea.population, vac.new_vaccinations
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` dea
JOIN `portfolioprojects-447322.Covid_data.CovidVaccinations` vac
  ON dea.location = vac.location 
  and dea.date = vac.date
WHERE dea.continent is not null
Order by 1, 2, 3

#looking at a rolling count of New Vaccinations over time per location

SELECT dea.continent, dea.location, dea.date, dea.population, vac.new_vaccinations, SUM(CAST(vac.new_vaccinations as int)) OVER (Partition by dea.location ORDER BY dea.location, dea.date) as RollingVaccineCount, 
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` dea
JOIN `portfolioprojects-447322.Covid_data.CovidVaccinations` vac
  ON dea.location = vac.location 
  and dea.date = vac.date
WHERE dea.continent is not null
Order by 2, 3

#back to Total Population vs Vaccinations to look at how many people of the total population are vaccinated on a rolling basis
#using a CTE

With PopvsVac #(continent, location, date, population, new_vaccinations, RollingVaccineCount)
as
(
SELECT dea.continent, dea.location, dea.date, dea.population, vac.new_vaccinations, SUM(CAST(vac.new_vaccinations as int)) OVER (Partition by dea.location ORDER BY dea.location, dea.date) as RollingVaccineCount, 
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` dea
JOIN `portfolioprojects-447322.Covid_data.CovidVaccinations` vac
  ON dea.location = vac.location 
  and dea.date = vac.date
WHERE dea.continent is not null
#Order by 2, 3
)
Select*, (RollingVaccineCount/population) * 100 as PopulationVaccinatedPercentage
From PopvsVac

#creating views to use later in visualizations
#view of Highest Continental Deaths

CREATE VIEW Covid_data.HighestContinentalDeaths as
SELECT continent, MAX(CAST (total_deaths as int)) as TotalDeathCount
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
#WHERE Location LIKE 'United States'
WHERE continent is not null
Group by continent
#order by TotalDeathCount desc

#view of Total Cases vs Total Deaths in U.S.

CREATE VIEW Covid_data.TotalCasesvsTotalDeathsinUS as
SELECT Location, date, total_cases, total_deaths,(total_deaths/NULLIF(total_cases, 0))* 100 AS DeathPercentage
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
WHERE Location LIKE 'United States'
and continent is not null
#order by 1, 2

#view of Total Cases vs Population in U.S.

CREATE VIEW Covid_data.TotalCasesvsPopulationinUS as
SELECT Location, date, population, total_cases, (total_cases/population) * 100 AS CasesPerPopPercentage
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
WHERE Location LIKE 'United States'
and continent is not null
order by 1, 2

#view of Countries with Highest Infection Count per Population

CREATE VIEW Covid_data.HighestInfectionCountperPopulation as
SELECT Location, population, MAX(total_cases) as HighestInfectionCount, MAX((total_cases/population)) * 100 AS CasesPerPopPercentage
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
#WHERE Location LIKE 'United States'
WHERE continent is not null
Group by Location, population
order by CasesPerPopPercentage desc

#view of Countries with Highest Death Count per Population

CREATE VIEW Covid_data.HighestDeathCountperPopulation as
SELECT Location, MAX(CAST (total_deaths as int)) as TotalDeathCount
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
#WHERE Location LIKE 'United States'
WHERE continent is not null
Group by location
order by TotalDeathCount desc

#view of Continental Highest Death Count

Create View Covid_data.ContinentalHighestDeathCount as
SELECT continent, MAX(CAST (total_deaths as int)) as TotalDeathCount
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
#WHERE Location LIKE 'United States'
WHERE continent is not null
Group by continent
order by TotalDeathCount desc

#view of Corrected Continental Highest Death Count

CREATE VIEW Covid_data.CorrectContinentalHighestDeathCount as
SELECT Location, MAX(CAST (total_deaths as int)) as TotalDeathCount
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
#WHERE Location LIKE 'United States'
WHERE continent is null
Group by location
order by TotalDeathCount desc

#view of Global Numbers

Create View Covid_data.GlobalNumbers as
SELECT date, SUM(new_cases) as TotalCases, SUM(CAST(new_deaths as int)) as TotalDeaths, SUM(CAST(new_deaths as int))/NULLIF(SUM(new_cases), 0) * 100 AS GlobalDeathPercentage
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
#WHERE Location LIKE 'United States'
WHERE continent is not null
Group by date
order by 1, 2

#view of Global Summary

Create View Covid_data.GlobalSummary as
SELECT SUM(new_cases) as TotalCases, SUM(CAST(new_deaths as int)) as TotalDeaths, SUM(CAST(new_deaths as int))/NULLIF(SUM(new_cases), 0) * 100 AS GlobalDeathPercentage
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` 
#WHERE Location LIKE 'United States'
WHERE continent is not null
#Group by date
order by 1, 2

#view of Total Population vs Vaccinations

Create View Covid_data.TotalPopulationvsVaccinations as
SELECT dea.continent, dea.location, dea.date, dea.population, vac.new_vaccinations
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` dea
JOIN `portfolioprojects-447322.Covid_data.CovidVaccinations` vac
  ON dea.location = vac.location 
  and dea.date = vac.date
WHERE dea.continent is not null
Order by 1, 2, 3

#view of Rolling New Vaccinations per Location

Create View Covid_data.RollingNewVaccinationsperLocation as
SELECT dea.continent, dea.location, dea.date, dea.population, vac.new_vaccinations, SUM(CAST(vac.new_vaccinations as int)) OVER (Partition by dea.location ORDER BY dea.location, dea.date) as RollingVaccineCount, 
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` dea
JOIN `portfolioprojects-447322.Covid_data.CovidVaccinations` vac
  ON dea.location = vac.location 
  and dea.date = vac.date
WHERE dea.continent is not null
Order by 2, 3

#view of Rolling Percentage of Population Vaccinated per Location

Create View Covid_data.RollingPercentageofPopulationVaccinatedperLocation as
With PopvsVac #(continent, location, date, population, new_vaccinations, RollingVaccineCount)
as
(
SELECT dea.continent, dea.location, dea.date, dea.population, vac.new_vaccinations, SUM(CAST(vac.new_vaccinations as int)) OVER (Partition by dea.location ORDER BY dea.location, dea.date) as RollingVaccineCount, 
FROM `portfolioprojects-447322.Covid_data.CovidDeaths` dea
JOIN `portfolioprojects-447322.Covid_data.CovidVaccinations` vac
  ON dea.location = vac.location 
  and dea.date = vac.date
WHERE dea.continent is not null
#Order by 2, 3
)
Select*, (RollingVaccineCount/population) * 100 as PopulationVaccinatedPercentage
From PopvsVac
